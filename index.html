<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erbbau-Rechner</title>
</head>
<body>
<style>
.erbpacht-rechner{max-width:600px;margin:20px auto;padding:20px;background-color:#f9f9f9;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);font-family:Arial,sans-serif}
.form-group{margin-bottom:15px}
label{display:block;margin-bottom:5px;font-weight:bold;color:#333}
input[type="number"],input[type="text"],input[type="date"],select{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px;box-sizing:border-box}
input[type="number"]{step:1;max-width:100px!important}
select{background-color:white;cursor:pointer}
h3{color:#042c54;font-size:14px;font-weight:bold;border-bottom:1px solid #ddd;padding-bottom:5px;font-family:Arial,sans-serif}
.link-container{margin-top:5px;font-size:12px}
.link-container a{color:#042c54;text-decoration:none}
.link-container a:hover{text-decoration:underline}
.results{margin-top:30px;padding:20px;background-color:#fff;border-radius:4px;border:1px solid #ddd}
.result-item{margin-bottom:20px;padding:15px;border-left:4px solid #042c54;background-color:#f8f9fa}
.result-item h3{margin:0 0 10px 0;color:#333;font-size:16px}
.result-values{display:flex;gap:20px;flex-wrap:wrap}
.result-value{background-color:#fff;padding:10px;border-radius:4px;border:1px solid #e0e0e0;min-width:120px}
.result-value strong{display:block;font-size:18px;color:#042c54}
.result-value span{font-size:12px;color:#666}
.calculate-btn{background-color:#042c54;color:white;padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:16px;margin-top:15px}
.calculate-btn:hover{background-color:#032040}
.result-subtitle{font-size:14px;color:#666;margin-bottom:10px;font-style:italic}
.difference{margin-top:10px;padding:8px;background-color:#fff;border-radius:4px;border:1px solid #e0e0e0;font-size:14px}
.difference.positive{color:#d9534f;font-weight:bold}
.difference.negative{color:#5cb85c;font-weight:bold}
@media (max-width:480px){.erbpacht-rechner{margin:10px;padding:15px}.result-values{flex-direction:column}}
</style>

<div class="erbpacht-rechner">
<h2>Erbbau-Rechner</h2>
<form id="erbpachtForm">
<div class="form-group">
<label for="grundstueck">Grundstücksgröße (m²):</label>
<input type="number" id="grundstueck" step="1" required>
</div>
<div class="form-group">
<label for="bodenricht">Bodenrichtwert (€/m²):</label>
<input type="number" id="bodenricht" value="430" step="1" required>
<div class="link-container">
<a href="https://immobilienmarkt.niedersachsen.de/bodenrichtwerte" target="_blank">Bodenrichtwert nachschlagen</a>
</div>
</div>
<div class="form-group">
<label for="bodenricht_2010">Bodenrichtwert (€/m²) 01.01.2010:</label>
<input type="number" id="bodenricht_2010" step="1" value="125">
<div class="link-container">
<a href="https://immobilienmarkt.niedersachsen.de/bodenrichtwerte" target="_blank">Bodenrichtwert nachschlagen, und den Stichtag 01.01.2010 auswählen</a>
</div>
</div>
<button type="button" class="calculate-btn" onclick="calc()">Berechnen</button>
</form>

<div class="results" id="results" style="display:none;">
<div class="result-item">
<h3>WIN-WIN-Lösungsmodell Erbbau (Initiative Erbbau LG)</h3>
<div class="result-subtitle">Bereinigter Bodenrichtwert (BerBRW): Um 8% Erschließungskosten und um den Verbraucherindex (VPI) von 2010-2025 bereinigter Bodenrichtwert</div>
<div class="result-values">
<div class="result-value">
<strong id="ini_boden">-</strong>
<span>Bereinigter Bodenrichtwert €/m²</span>
</div>
<div class="result-value">
<strong id="ini_jahr">-</strong>
<span>jährlich</span>
</div>
<div class="result-value">
<strong id="ini_monat">-</strong>
<span>monatlich</span>
</div>
<div class="result-value">
<strong id="ini_zins">-</strong>
<span>Erbbauzins</span>
</div>
<div class="result-value" id="ini_anteil_box" style="display:none;">
<strong id="ini_anteil">-</strong>
<span>% vom Nettoeinkommen</span>
</div>
</div>
</div>

<div class="result-item">
<h3>Lüneburger Modell (Hansestadt Lüneburg)</h3>
<div class="result-subtitle">Erbbauzinssatz - Vom Bodenrichtwert wurden 27 €/m² für Erschließungskosten abgezogen</div>
<div class="result-values">
<div class="result-value">
<strong id="lg_boden">-</strong>
<span>Bodenrichtwert €/m²</span>
</div>
<div class="result-value">
<strong id="lg_jahr">-</strong>
<span>jährlich</span>
</div>
<div class="result-value">
<strong id="lg_monat">-</strong>
<span>monatlich</span>
</div>
<div class="result-value">
<strong id="lg_zins">-</strong>
<span>Erbbauzins</span>
</div>
<div class="result-value" id="lg_anteil_box" style="display:none;">
<strong id="lg_anteil">-</strong>
<span>% vom Nettoeinkommen</span>
</div>
</div>
<div class="difference" id="lg_diff">-</div>
</div>

<div class="result-item">
<div class="result-subtitle">Wohnraum für Familien, mind. 1 kindergeldberechtigtes Kind oder Wohnraum für Senior:innen - Vom Bodenrichtwert wurden 27 €/m² für Erschließungskosten abgezogen</div>
<div class="result-values">
<div class="result-value">
<strong id="fam_boden">-</strong>
<span>Bodenrichtwert €/m²</span>
</div>
<div class="result-value">
<strong id="fam_jahr">-</strong>
<span>jährlich</span>
</div>
<div class="result-value">
<strong id="fam_monat">-</strong>
<span>monatlich</span>
</div>
<div class="result-value">
<strong id="fam_zins">-</strong>
<span>Erbbauzins</span>
</div>
<div class="result-value" id="fam_anteil_box" style="display:none;">
<strong id="fam_anteil">-</strong>
<span>% vom Nettoeinkommen</span>
</div>
</div>
<div class="difference" id="fam_diff">-</div>
</div>

<div class="result-item">
<h3>Aktuelle Erbpacht Klosterkammer</h3>
<div class="result-subtitle">Vom Bodenrichtwert wurden 30% für Erschließungskosten abgezogen</div>
<div class="result-values">
<div class="result-value">
<strong id="kl_boden">-</strong>
<span>Bodenrichtwert €/m²</span>
</div>
<div class="result-value">
<strong id="kl_jahr">-</strong>
<span>jährlich</span>
</div>
<div class="result-value">
<strong id="kl_monat">-</strong>
<span>monatlich</span>
</div>
<div class="result-value">
<strong id="kl_zins">-</strong>
<span>Erbbauzins</span>
</div>
<div class="result-value" id="kl_anteil_box" style="display:none;">
<strong id="kl_anteil">-</strong>
<span>% vom Nettoeinkommen</span>
</div>
</div>
<div class="difference" id="kl_diff">-</div>
</div>

<div class="result-item">
<h3>Modellvorschlag Klosterkammer Hannover</h3>
<div class="result-subtitle">Zinssatz: tagesvariabler Zinssatz 10-jähriger Bundesanleihen (Kapitalmarktpapier), vorgesehen zwischen mind. 2% und max. 4%. 100% Bodenrichtwert ohne Abzug. 30% Rabatt auf die berechneten Erbbauzinsen für 20 Jahre – nur für Osnabrück, Göttingen, Hildesheim, Lüneburg. WICHTIG: Rabatt entfällt sofort bei Tod oder Verkauf. In dem Beispiel rechnen wir mit einem Zinssatz von 2.8%</div>
<div class="result-values">
<div class="result-value">
<strong id="km2_boden">-</strong>
<span>Bodenrichtwert €/m² (100%)</span>
</div>
<div class="result-value">
<strong style="text-decoration:line-through;color:#999;" id="km2_jahr_base">-</strong>
<span>jährlich (Basiswert)</span>
</div>
<div class="result-value" style="background-color:#e8f5e9;">
<strong id="km2_jahr">-</strong>
<span>jährlich (mit 30% Rabatt)</span>
</div>
<div class="result-value">
<strong id="km2_monat">-</strong>
<span>monatlich</span>
</div>
<div class="result-value">
<strong id="km2_zins">-</strong>
<span>Erbbauzins</span>
</div>
<div class="result-value" id="km2_anteil_box" style="display:none;">
<strong id="km2_anteil">-</strong>
<span>% vom Nettoeinkommen</span>
</div>
</div>
<div class="difference" id="km2_diff">-</div>
</div>
</div>

<div id="email-section" style="display:none;margin-top:30px;padding:20px;background-color:#f0f8ff;border-radius:8px;border:1px solid #042c54;">
<p style="margin-bottom:15px;color:#333;font-size:14px;text-align:left;">
Folgende Informationen zu Ihrer Einkommenssituation sind für die weitere Entwicklung des WIN-WIN-Lösungsmodells der Initiative hilfreich, um den Anteil der zu zahlenden Erbpacht am Nettoeinkommen zu berechnen und zu überprüfen, ob sich dieser in einem angemessenen Rahmen bewegt.<br><br>
Alle Eingabefelder sind optional. Die eingegebenen Daten werden nicht gespeichert. Die Daten werden vertraulich behandelt und nur für den Zweck der Statistik ausgewertet. Einfach auf den Button klicken und die E-Mail abschicken.<br><br>
Vielen Dank
</p>
<div class="form-group">
<label for="einkommen">Haushaltsnettoeinkommen pro Monat (€):</label>
<input type="number" id="einkommen" step="1">
</div>
<div class="form-group">
<label for="adresse">Straße und Hausnummer:</label>
<input type="text" id="adresse">
</div>
<div class="form-group">
<label for="wertmind">Wertminderungen Grundstück:</label>
<input type="text" id="wertmind" placeholder="z.B. Senkungsgebiet, Lärm, Bebauung">
</div>
<h3 style="margin-top:25px;margin-bottom:15px;color:#333;">Bestehender Erbbaurechtsvertrag</h3>
<div class="form-group">
<label for="erstellung">Erstellungsdatum:</label>
<input type="date" id="erstellung">
</div>
<div class="form-group">
<label for="laufzeit">Laufzeit (Jahre):</label>
<input type="number" id="laufzeit" step="1">
</div>
<div class="form-group">
<label for="akt_zinsen">Höhe der aktuellen jährlichen Erbbauzinsen (€):</label>
<input type="number" id="akt_zinsen" step="1">
</div>
<div class="form-group">
<label for="anpassung">Regelmäßige Wertanpassung:</label>
<select id="anpassung">
<option value="">Bitte wählen</option>
<option value="ja">Ja</option>
<option value="nein">Nein</option>
</select>
</div>
<div style="text-align:center;">
<button type="button" class="calculate-btn" onclick="sendEmail()" style="background-color:#28a745;margin:0;">
E-Mail versenden
</button>
</div>
</div>
</div>

<script>
function sanitizeInput(str) {
    if (!str) return 'nicht angegeben';
    // Entferne gefährliche Zeichen: ; & < > ' " \ / % + = ( ) [ ] { } | ~ `
    return str.toString().replace(/[;&<>'"\\/%+=\(\)\[\]{}|~`]/g, '').trim() || 'nicht angegeben';
}

function calc() {
    const groesse = parseFloat(document.getElementById('grundstueck').value);
    const boden = parseFloat(document.getElementById('bodenricht').value);
    const boden2010 = parseFloat(document.getElementById('bodenricht_2010').value);
    const netto = parseFloat(document.getElementById('einkommen').value);
    
    if (isNaN(groesse) || isNaN(boden) || isNaN(boden2010)) {
        alert('Bitte fülle alle Pflichtfelder korrekt aus.');
        return;
    }
    
    const ini_boden = boden2010 * 0.92 * 1.34;
    const ini_grund = groesse * ini_boden;
    const ini_jahr = ini_grund * 2 / 100;
    const ini_monat = ini_jahr / 12;
    
    const kl_boden = boden * 0.70;
    const kl_grund = groesse * kl_boden;
    const kl_jahr = kl_grund * 0.05;
    const kl_monat = kl_jahr / 12;
    
    const lg_boden = boden - 27;
    const lg_grund = groesse * lg_boden;
    const lg_jahr = lg_grund * 0.025;
    const lg_monat = lg_jahr / 12;
    
    const fam_boden = boden - 27;
    const fam_grund = groesse * fam_boden;
    const fam_jahr = fam_grund * 0.02;
    const fam_monat = fam_jahr / 12;

    // Modellvorschlag Klosterkammer Hannover
    const km2_boden = boden;  // 100% current BRW, no cost deduction
    const km2_grund = groesse * km2_boden;
    const km2_jahr_base = km2_grund * 0.028;  // Base rent at 2.8%
    const km2_jahr = km2_jahr_base * 0.70;     // 30% discount on RENT
    const km2_monat = km2_jahr / 12;

    document.getElementById('ini_boden').textContent = formatCurrency(ini_boden);
    document.getElementById('ini_jahr').textContent = formatCurrency(ini_jahr);
    document.getElementById('ini_monat').textContent = formatCurrency(ini_monat);
    document.getElementById('ini_zins').textContent = '2%';
    
    document.getElementById('kl_boden').textContent = formatCurrency(kl_boden);
    document.getElementById('kl_jahr').textContent = formatCurrency(kl_jahr);
    document.getElementById('kl_monat').textContent = formatCurrency(kl_monat);
    document.getElementById('kl_zins').textContent = '5%';
    
    document.getElementById('lg_boden').textContent = formatCurrency(lg_boden);
    document.getElementById('lg_jahr').textContent = formatCurrency(lg_jahr);
    document.getElementById('lg_monat').textContent = formatCurrency(lg_monat);
    document.getElementById('lg_zins').textContent = '2.5%';
    
    document.getElementById('fam_boden').textContent = formatCurrency(fam_boden);
    document.getElementById('fam_jahr').textContent = formatCurrency(fam_jahr);
    document.getElementById('fam_monat').textContent = formatCurrency(fam_monat);
    document.getElementById('fam_zins').textContent = '2%';

    document.getElementById('km2_boden').textContent = formatCurrency(km2_boden);
    document.getElementById('km2_jahr_base').textContent = formatCurrency(km2_jahr_base);
    document.getElementById('km2_jahr').textContent = formatCurrency(km2_jahr);
    document.getElementById('km2_monat').textContent = formatCurrency(km2_monat);
    document.getElementById('km2_zins').textContent = '2.8% (variabel)';

    if (!isNaN(netto) && netto > 0) {
        showPercent('ini_anteil', 'ini_anteil_box', ini_monat, netto);
        showPercent('kl_anteil', 'kl_anteil_box', kl_monat, netto);
        showPercent('lg_anteil', 'lg_anteil_box', lg_monat, netto);
        showPercent('fam_anteil', 'fam_anteil_box', fam_monat, netto);
        showPercent('km2_anteil', 'km2_anteil_box', km2_monat, netto);
    } else {
        document.getElementById('ini_anteil_box').style.display = 'none';
        document.getElementById('kl_anteil_box').style.display = 'none';
        document.getElementById('lg_anteil_box').style.display = 'none';
        document.getElementById('fam_anteil_box').style.display = 'none';
        document.getElementById('km2_anteil_box').style.display = 'none';
    }
    
    showDiff('kl_diff', kl_jahr, ini_jahr);
    showDiff('lg_diff', lg_jahr, ini_jahr);
    showDiff('fam_diff', fam_jahr, ini_jahr);
    showDiff('km2_diff', km2_jahr, ini_jahr);

    document.getElementById('results').style.display = 'block';
    document.getElementById('email-section').style.display = 'block';
}

function formatCurrency(amount) {
    return new Intl.NumberFormat('de-DE', {
        style: 'currency',
        currency: 'EUR',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    }).format(amount);
}

function showDiff(elementId, current, reference) {
    const diff = current - reference;
    const element = document.getElementById(elementId);
    
    if (diff > 0) {
        element.textContent = 'Differenz: +' + formatCurrency(diff) + ' mehr pro Jahr im Vergleich zum WIN-WIN-Lösungsmodell Erbbau';
        element.className = 'difference positive';
    } else if (diff < 0) {
        element.textContent = 'Differenz: ' + formatCurrency(Math.abs(diff)) + ' weniger pro Jahr im Vergleich zum WIN-WIN-Lösungsmodell Erbbau';
        element.className = 'difference negative';
    } else {
        element.textContent = 'Differenz: Gleicher Betrag';
        element.className = 'difference';
    }
}

function showPercent(elementId, containerId, monthly, income) {
    const percent = (monthly / income) * 100;
    document.getElementById(elementId).textContent = percent.toFixed(1) + '%';
    document.getElementById(containerId).style.display = 'block';
}

function sendEmail() {
    const groesse = sanitizeInput(document.getElementById('grundstueck').value);
    const boden = sanitizeInput(document.getElementById('bodenricht').value);
    const boden2010 = sanitizeInput(document.getElementById('bodenricht_2010').value);
    const netto = sanitizeInput(document.getElementById('einkommen').value);
    const addr = sanitizeInput(document.getElementById('adresse').value);
    const wert = sanitizeInput(document.getElementById('wertmind').value);
    const erst = sanitizeInput(document.getElementById('erstellung').value);
    const lauf = sanitizeInput(document.getElementById('laufzeit').value);
    const zins = sanitizeInput(document.getElementById('akt_zinsen').value);
    const anp = sanitizeInput(document.getElementById('anpassung').value);
    
    const betreff = encodeURIComponent('Erbbau-Berechnung Lüneburg - ' + new Date().toLocaleDateString('de-DE'));
    const text = `Erbbau-Daten vom ${new Date().toLocaleDateString('de-DE')}

Grundstueck: ${groesse}
Bodenrichtwert: ${boden}
Bodenrichtwert 2010: ${boden2010}
Nettoeinkommen: ${netto}
Adresse: ${addr}
Wertminderungen: ${wert}

Bestehender Vertrag:
Erstellung: ${erst}
Laufzeit: ${lauf}
Aktuelle Zinsen: ${zins}
Wertanpassung: ${anp}`;

    // Erstelle mailto-Link komplett dynamisch
    const mailto = ['mailto:', 'ini-bwe-lg@web.de', '?subject=', betreff, String.fromCharCode(38), 'body=', encodeURIComponent(text)].join('');
    window.location.href = mailto;
}

document.getElementById('erbpachtForm').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        calc();
    }
});
</script>
</body>
</html>